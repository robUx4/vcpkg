From d1799b6bb06925f46888cc420afaa51d55ab3f10 Mon Sep 17 00:00:00 2001
From: Steve Lhomme <robux4@ycbcr.xyz>
Date: Mon, 10 Apr 2023 16:00:39 +0200
Subject: [PATCH] generate a CMake config file

---
 src/CMakeLists.txt       | 28 ++++++++++++++++++++++++++--
 src/soxr-config.cmake.in |  5 +++++
 2 files changed, 31 insertions(+), 2 deletions(-)
 create mode 100644 src/soxr-config.cmake.in

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 24ecd5d..a1bf962 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -82,7 +82,6 @@ set_target_properties (${PROJECT_NAME} PROPERTIES
   VERSION "${SO_VERSION}"
   SOVERSION ${SO_VERSION_MAJOR}
   INSTALL_NAME_DIR ${LIB_INSTALL_DIR}
-  LINK_INTERFACE_LIBRARIES ""
   PUBLIC_HEADER "${PROJECT_NAME}.h")
 if (BUILD_FRAMEWORK)
   set_target_properties (${PROJECT_NAME} PROPERTIES FRAMEWORK TRUE)
@@ -106,7 +105,6 @@ if (WITH_LSR_BINDINGS)
     VERSION "${LSR_SO_VERSION}"
     SOVERSION ${LSR_SO_VERSION_MAJOR}
     INSTALL_NAME_DIR ${LIB_INSTALL_DIR}
-    LINK_INTERFACE_LIBRARIES ""
     PUBLIC_HEADER "${LSR}.h")
   if (BUILD_FRAMEWORK)
     set_target_properties (${LSR} PROPERTIES FRAMEWORK TRUE)
@@ -122,8 +120,34 @@ endif ()
 # Installation (from build from source):
 
 install (TARGETS ${PROJECT_NAME} ${LSR}
+  EXPORT soxr
   FRAMEWORK DESTINATION ${FRAMEWORK_INSTALL_DIR}
   LIBRARY DESTINATION ${LIB_INSTALL_DIR}
   RUNTIME DESTINATION ${BIN_INSTALL_DIR}
   ARCHIVE DESTINATION ${LIB_INSTALL_DIR}
   PUBLIC_HEADER DESTINATION ${INCLUDE_INSTALL_DIR})
+
+include(CMakePackageConfigHelpers)
+include(GNUInstallDirs)
+
+install(EXPORT soxr 
+  FILE soxr.cmake
+  NAMESPACE Soxr::
+  DESTINATION "${CMAKE_INSTALL_DATADIR}/${PROJECT_NAME}" )
+
+configure_package_config_file(
+  "${CMAKE_CURRENT_SOURCE_DIR}/soxr-config.cmake.in"
+  "${CMAKE_CURRENT_BINARY_DIR}/soxr-config.cmake"
+  INSTALL_DESTINATION "share/soxr"
+)
+write_basic_package_version_file(
+  "${CMAKE_CURRENT_BINARY_DIR}/soxr-config-version.cmake"
+  VERSION "${CMAKE_PROJECT_VERSION}"
+  COMPATIBILITY SameMajorVersion
+)
+install(
+  FILES 
+    "${CMAKE_CURRENT_BINARY_DIR}/soxr-config.cmake"
+    "${CMAKE_CURRENT_BINARY_DIR}/soxr-config-version.cmake"
+  DESTINATION "share/soxr"
+)
diff --git a/src/soxr-config.cmake.in b/src/soxr-config.cmake.in
new file mode 100644
index 0000000..64dd1c5
--- /dev/null
+++ b/src/soxr-config.cmake.in
@@ -0,0 +1,5 @@
+@PACKAGE_INIT@
+
+include("${CMAKE_CURRENT_LIST_DIR}/soxr.cmake")
+
+check_required_components(soxr)
-- 
2.38.1.windows.1

